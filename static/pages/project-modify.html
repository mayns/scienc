<link rel="import" href="/static/elements/polymer/polymer.html"/>
<link rel="import" href="/static/elements/break-line.html"/>
<link rel="import" href="/static/elements/ajax-json-form.html"/>
<link rel="import" href="/static/elements/input-tags.html"/>
<link rel="import" href="/static/elements/core-overlay/core-overlay.html"/>
<link rel="import" href="/static/mixins.html"/>

<polymer-element name="project-modify" attributes="data" class="container main">
	<template>
		<style>
            :host {
                display: block;
            }
            .projec-form section {
                color: #333;
            }
            .projec-form fieldset {
                padding: 20px 20px 30px;
                margin-bottom: 40px;
                border: 1px solid #cccccc;
            }
            .projec-form fieldset fieldset {
                border: none;
                margin-bottom: 0;
                padding-left: 0;
                padding-right: 0;
            }
            .projec-form fieldset fieldset legend {
                font-size: 22px;
            }
            .projec-form  legend {
                font-size: 30px;
            }
            .projec-form  legend .icon {
                vertical-align: middle;
            }
            .icon {
                width: 20px;
                height: 20px;
            }
			form {
				padding-bottom: 70px;
			}
			form .row-flex {
				margin-bottom: 20px;
			}
			form .row-flex:last-child {
				margin-bottom: 0;
			}
            input, textarea {
                border: none;
                border-bottom: 1px solid #ccc; 
            }
            input:focus, textarea:focus {
                outline: none;
            }
            .fieldblock {
                padding-left: 40px;
                position: relative;
            }
            .fieldblock + .fieldblock {
                padding-top: 40px;
                border-top: 1px solid #ccc;
                margin-top: 40px;
            }
            .deleteItem {
                position: absolute;
                top: 50%;
                left: 0;
                margin-top: -10px;
            }
            legend {
                font-size: 30px;
            }
		</style>
		<section vertical layout class="projec-form">
			<form is="ajax-json-form"
                  ajaxMethod="{{ ajaxMethod }}"
                  action="/api/project"
                  redirect="/">
                <template bind="{{ data }}">
                    <fieldset>
                        <legend>Общие сведения</legend>
                        <div class="row-flex fieldblock">
                            <div class="col-lg-12">
                                <div class="row-flex middle">
                                    <label for="title" class="action col-lg-3">Название проекта</label>
                                </div>
                                <div class="row-flex">
                                    <div class="col-lg-12">
                                        <input type="text"
                                               id="title"
                                               name="title"
                                               value="{{ title }}"
                                               data-json="title"
                                               required/>
                                    </div>
                                </div>
                                <div class="row-flex middle">
                                    <label class="action row-flex col-lg-12">Область науки</label>
                                </div>
                                <div class="row-flex">
                                    <div class="col-lg-12">
                                        <input type="text" id="researchFields" on-focus="{{ showResearchFields }}" value="{{ research_fields }}"/>
                                        <!--<template repeat="{{ field in research_fields }}">-->
                                            <!--<span>{{ field }}</span>-->
                                        <!--</template>-->
                                        <core-overlay id="researchFieldsDialog" on-core-overlay-close-completed="{{ onDialogClose }}" class="research-fields-dialog" layered backdrop>
                                            <div class="row-flex col-lg-12">
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/math.svg" alt=""/>
                                                    <label class="label action col-lg-10" for="math">Математика, информатика, механика</label>
                                                    <input class="checkbox" type="checkbox" value="math" id="math" data-json="research_fields[]"/>
                                                </div>
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/physics.svg" alt=""/>
                                                    <label for="physics" class="action col-lg-10 label">Физика и астрономия</label>
                                                    <input class="checkbox" type="checkbox" value="physics" id="physics" data-json="research_fields[]"/>
                                                </div>
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/chemistry.svg" alt=""/>
                                                    <label for="chemistry" class="action col-lg-10 label">Химия</label>
                                                    <input class="checkbox" type="checkbox" value="chemistry" id="chemistry" data-json="research_fields[]"/>
                                                </div>
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/cs.svg" alt=""/>
                                                    <label for="it_science" class="action col-lg-10 label">Информационные технологии и вычеслительные системы</label>
                                                    <input class="checkbox" type="checkbox" value="it_science" id="it_science" data-json="research_fields[]"/>
                                                </div>
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/biology.svg" alt=""/>
                                                    <label for="biology" class="action col-lg-10 label">Биология и медицинская наука</label>
                                                    <input class="checkbox" type="checkbox" value="biology" id="biology" data-json="research_fields[]"/>
                                                </div>
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/earth.svg" alt=""/>
                                                    <label for="earth" class="action col-lg-10 label">Науки о Земле</label>
                                                    <input class="checkbox" type="checkbox" value="earth" id="earth" data-json="research_fields[]"/>
                                                </div>
                                                <div class="row-flex middle">
                                                    <img class="icon" src="/static/images/engineer.svg" alt=""/>
                                                    <label for="engeneering" class="action col-lg-10 label">Инженерные науки</label>
                                                    <input class="checkbox" type="checkbox" value="engeneering" id="engeneering" data-json="research_fields[]"/>
                                                </div>
                                            </div>    
                                        </core-overlay>
                                    </div>
                                </div>
                                <div class="row-flex middle">
                                    <label class="col-lg-3">Связь с университетами</label>
                                    <input type="checkbox" checked="{{ university }}"/>
                                    <template if="{{ university }}">
                                        <img on-click="{{ addItem }}" data-itemtype="university_connection" class="action icon"
                                             src="/static/images/plus.svg"
                                             alt="" />
                                    </template>
                                </div>
                                <template if="{{ university }}">
                                    <template repeat="{{ university_connection }}">
                                        <div class="fieldblock">
                                            <div class="row-flex">
                                                <div class="col-lg-2">
                                                    <label for="">Страна</label>
                                                </div>
                                                <div class="col-lg-10">
                                                    <input type="text" data-json="university_connection[][country]"/>
                                                </div>
                                            </div>
                                            <div class="row-flex">
                                                <div class="col-lg-2">
                                                    <label for="">Город</label>
                                                </div>
                                                <div class="col-lg-10">
                                                    <input type="text" data-json="university_connection[][city]"/>
                                                </div>
                                            </div>
                                            <div class="row-flex">
                                                <div class="col-lg-2">
                                                    <label for="">Университет</label>
                                                </div>
                                                <div class="col-lg-10">
                                                    <input type="text" data-json="university_connection[][university]"/>
                                                </div>
                                            </div>
                                            <div class="row-flex">
                                                <div class="col-lg-2">
                                                    <label for="">Факультет</label>
                                                </div>
                                                <div class="col-lg-10">
                                                    <input type="text" data-json="university_connection[][faculty]"/>
                                                </div>
                                            </div>
                                            <div class="row-flex">
                                                <div class="col-lg-2">
                                                    <label for="">Кафедра</label>
                                                </div>
                                                <div class="col-lg-10">
                                                    <input type="text" data-json="university_connection[][chair]"/>
                                                </div>
                                            </div>
                                            <div class="row-flex"></div>
                                            <img class="deleteItem icon action"
                                                 data-itemtype="university_connection"
                                                 on-click="{{ deleteItem }}"
                                                 src="/static/images/minus.svg" alt=""/>
                                        </div>
                                    </template>
                                </template>
                                <!--<div class="row-flex">-->
                                <!--<break-line bgcolor="#ccc"></break-line>-->
                                <!--</div>-->
                                <div class="row-flex">
                                    <label for="description_short">Краткое описание</label>
                                </div>
                                <div class="row-flex">
                                <textarea name="description_short"
                                          data-json="description_short"
                                          id="description_short"
                                          value="{{ description_short }}"
                                          class="col-lg-12" required></textarea>
                                </div>

                            </div>
                        </div>
                    </fieldset>
                    <!--<h2>Цели исследования</h2>-->
                    <!--<div class="row">-->
                    <!--<textarea name="objective" id="objective" class="col-lg-12"></textarea>-->
                    <!--</div>-->
                    <!--<h2>Полное описание</h2>-->
                    <!--<div class="row">-->
                    <!--<textarea name="description_full" id="description_full" class="col-lg-12"></textarea>-->
                    <!--</div>-->
                    <!--<h2>Возможности применения результатов</h2>-->
                    <!--<div class="row">-->
                    <!--<textarea name="usage_possibilities" id="usage_possibilities" class="col-lg-12"></textarea>-->
                    <!--</div>-->
                    <!--<h2>Достигнуты результаты</h2>-->
                    <!--<div class="row">-->
                    <!--<textarea name="results" id="results" class="col-lg-12"></textarea>-->
                    <!--</div>-->
                    <!--<h2>Руководитель проекта</h2>-->
                    <!--<div class="row">-->
                    <!--<input name="leader" id="leader" class="col-lg-12">-->
                    <!--</div>-->
                    <!--<h2>Учатники проекта</h2>-->
                    <!--<html-repeater>-->
                    <!--<div class="row" container>-->
                    <!--<div class="col-lg-4">-->
                    <!--<input type="text" placeholder="ФИО" name="participants[][name]"/>-->
                    <!--</div>-->
                    <!--<div class="col-lg-4 col-lg-offset-1">-->
                    <!--<input type="text" placeholder="Роль в проекте" name="participants[][role]"/>-->
                    <!--</div>-->
                    <!--<button add class="col-lg-1">Add</button>-->
                    <!--<button delete class="col-lg-1">Delete</button>-->
                    <!--</div>-->
                    <!--</html-repeater>-->
                    <!--<h2>Разыскиваются</h2>-->
                    <!--<html-repeater>-->
                    <!--<div class="row" container>-->
                    <!--<div class="col-lg-12">-->
                    <!--<div class="row">-->
                    <!--<label for="">Должность</label>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                    <!--<input type="text" class="col-lg-12" name="missed_participants[][role]"/>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                    <!--<label for="">Описание</label>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                    <!--<textarea id="" class="col-lg-12" name="missed_participants[][description]"></textarea>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                    <!--<button add>Add</button>-->
                    <!--<button delete>Delete</button>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</html-repeater>-->
                    <!--<h2>Тэги</h2>-->
                    <!--<div class="row">-->
                    <!--<input-tags id="" class="col-lg-12" name="tags[]" required></input-tags>-->
                    <!--</div>-->
                    <!--<h2>Контактные данные</h2>-->
                    <!--<html-repeater>-->
                    <!--<div class="row" container>-->
                    <!--<input type="text" class="col-lg-3" name="contacts[][email]" placeholder="email"/>-->
                    <!--<button add>Add</button>-->
                    <!--<button delete>Delete</button>-->
                    <!--</div>-->
                    <!--</html-repeater>-->
                    <!--<html-repeater>-->
                    <!--<div class="row" container>-->
                    <!--<input type="text" class="col-lg-3" name="contacts[][phone]" placeholder="телефон"/>-->
                    <!--<button add>Add</button>-->
                    <!--<button delete>Delete</button>-->
                    <!--</div>-->
                    <!--</html-repeater>-->
                    <!--<html-repeater>-->
                    <!--<div class="row" container>-->
                    <!--<input type="text" class="col-lg-3" name="contacts[][skype]" placeholder="skype"/>-->
                    <!--<button add>Add</button>-->
                    <!--<button delete>Delete</button>-->
                    <!--</div>-->
                    <!--</html-repeater>-->
                    <!--<h2>Контактное лицо</h2>-->
                    <!--<div class="row">-->
                    <!--<input type="text" class="col-lg-12" name="contact_manager"/>-->
                    <!--</div>-->
                    <div class="row center">
                        <button type="submit" class="button submit">Добавить</button>
                    </div>
                </template>
			</form>
		</section>
	</template>
    <script>
        Polymer('project-modify', Polymer.mixin({
            publish: {
                data: {
                    university_connection: [1]
                },
                viewType: 'create'
            },
            onDialogClose: function() {
                var researchFields = $$.qsa('.checkbox',this.$.researchFieldsDialog)
                        .filter(function(item){
                            return item.checked;
                        })
                        .map(function(item){
                            return item.value;
                        });

                this.$.researchFields.value = researchFields;
            },
            showResearchFields: function() {
                this.$.researchFieldsDialog.open();    
            },
            computed: {
                ajaxMethod: "viewType === 'create' ? 'POST' : 'PUT'"
            }
        }, window.Mixins.dynamicFields));
    </script>
</polymer-element>